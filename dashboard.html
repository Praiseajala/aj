<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - BTC Mining Pro</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
  header { background: #007bff; padding: 15px; color: white; text-align: center; }
  nav { margin: 15px; text-align: center; }
  nav a { margin: 0 15px; text-decoration: none; color: #007bff; font-weight: bold; }
  .container { max-width: 900px; margin: 20px auto; padding: 20px; }
  .card { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
  .card h3 { margin: 10px 0; color: #333; }
  .status { font-size: 16px; margin: 10px 0; }
  .pending { color: #dc3545; font-weight: bold; }
  .confirmed { color: #28a745; font-weight: bold; }
  .balance { font-size: 22px; color: #222; margin-top: 10px; }
  .logout-btn, .buy-btn { display: inline-block; margin-top: 15px; padding: 10px 18px; color: white; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; }
  .logout-btn { background: #dc3545; }
  .logout-btn:hover { background: #b02a37; }
  .buy-btn { background: #28a745; }
  .buy-btn:hover { background: #218838; }
  .progress-container { background: #e0e0e0; border-radius: 20px; margin: 10px 0; height: 25px; width: 100%; overflow: hidden; }
  .progress-bar { height: 100%; width: 0%; background: #28a745; border-radius: 20px; text-align: center; color: white; line-height: 25px; font-weight: bold; transition: width 1s linear; }
  .stats-grid { display: flex; justify-content: space-around; flex-wrap: wrap; }
  .stat-box { background: #f9f9f9; padding: 15px; margin: 10px; border-radius: 10px; flex: 1 1 250px; }
  .stat-box h4 { margin: 5px 0; }
  @media (max-width: 768px) { nav a { display: block; margin: 10px 0; } .stats-grid { flex-direction: column; align-items: center; } }

  /* Notification Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 200;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5);
  }
  .modal-content {
    background: #fff;
    margin: 20% auto;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .modal-content button {
    margin-top: 15px;
    padding: 10px 15px;
    background: #28a745;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  .modal-content button:hover { background: #218838; }
</style>
</head>
<body>

<header>
  <h1>BTC Mining Pro Dashboard</h1>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="plans.html">Plans</a>
  <a href="withdraw.html">Withdraw</a>
  <a href="contact.html">Contact</a>
</nav>

<div class="container">
  <!-- Plan Info -->
  <div class="card">
    <h3>Your Plan</h3>
    <div id="planName">No Plan Selected</div>
    <button id="buyPlanBtn" class="buy-btn" onclick="goToPlans()" style="display:none;">Buy a Plan</button>
  </div>

  <!-- Payment Status -->
  <div class="card">
    <h3>Payment Status</h3>
    <div id="paymentStatus" class="status pending"></div>
  </div>

  <!-- Mining Info -->
  <div class="card">
    <h3>Mining Rate</h3>
    <div id="miningRate">0 BTC/day</div>
  </div>

  <div class="card">
    <h3>Mining Balance</h3>
    <div class="balance" id="miningBalance">0.000000 BTC</div>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar">0%</div>
    </div>
  </div>

  <!-- Earnings & Referral Stats -->
  <div class="card stats-grid">
    <div class="stat-box">
      <h4>Total BTC Mined</h4>
      <div id="totalMined">0.000000 BTC</div>
    </div>
    <div class="stat-box">
      <h4>Estimated Earnings</h4>
      <div id="estimatedEarnings">$0.00</div>
    </div>
    <div class="stat-box">
      <h4>Referral Stats</h4>
      <div id="referrals">0 Referrals</div>
    </div>
  </div>

  <!-- Logout -->
  <div class="card">
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</div>

<!-- Notification Modal -->
<div id="notificationModal" class="modal">
  <div class="modal-content">
    <p id="notificationMessage"></p>
    <button id="closeNotificationBtn">Close</button>
  </div>
</div>

<script>
const btcPriceUSD = 30000;
const planRates = { "Starter": 0.006, "Silver": 0.018, "Gold": 0.04 };

const currentUser = localStorage.getItem("currentUser");
let users = JSON.parse(localStorage.getItem("users")) || {};
let userData = users[currentUser] || { plan:"", paymentConfirmed:false, balance:0, totalMined:0, referrals:0 };

const planName = document.getElementById("planName");
const paymentStatus = document.getElementById("paymentStatus");
const miningRate = document.getElementById("miningRate");
const miningBalance = document.getElementById("miningBalance");
const progressBar = document.getElementById("progressBar");
const totalMinedEl = document.getElementById("totalMined");
const estimatedEarningsEl = document.getElementById("estimatedEarnings");
const referralsEl = document.getElementById("referrals");
const buyPlanBtn = document.getElementById("buyPlanBtn");

let lastMiningTime = parseInt(localStorage.getItem(currentUser + "_lastMine")) || Date.now();

// Notification modal elements
const notificationModal = document.getElementById("notificationModal");
const notificationMessage = document.getElementById("notificationMessage");
const closeNotificationBtn = document.getElementById("closeNotificationBtn");

function showNotification(type,message){
  notificationMessage.innerText = message;
  notificationModal.style.display = "block";
}

closeNotificationBtn.onclick = function(){ notificationModal.style.display = "none"; }
window.onclick = function(event){ if(event.target == notificationModal){ notificationModal.style.display = "none"; } }

function updateProgressBar(){
  const plan = userData.plan;
  if(!plan){ progressBar.style.width = "0%"; progressBar.innerText = "0%"; return; }
  const percent = Math.min((userData.balance / planRates[plan])*100,100);
  progressBar.style.width = percent + "%";
  progressBar.innerText = percent.toFixed(1) + "%";
}

function startMining() {
  if(userData.plan && !userData.paymentConfirmed){
    paymentStatus.innerHTML = "⏳ Starting Mining...";
    paymentStatus.classList.remove("confirmed");
    paymentStatus.classList.add("pending");

    setTimeout(()=>{
      userData.paymentConfirmed = true;
      users[currentUser] = userData;
      localStorage.setItem("users", JSON.stringify(users));
      paymentStatus.innerHTML = "✅ Mining Started!";
      paymentStatus.classList.remove("pending");
      paymentStatus.classList.add("confirmed");
      showNotification("success","Mining has started!");
    }, 5000);
  }
}

function updateDashboard(){
  const plan = userData.plan;
  planName.innerText = plan || "No Plan Bought";
  buyPlanBtn.style.display = plan ? "none" : "inline-block";
  miningRate.innerText = plan ? planRates[plan] + " BTC/day" : "0 BTC/day";

  if(plan && !userData.paymentConfirmed){
    startMining();
  } else if(plan && userData.paymentConfirmed){
    paymentStatus.innerHTML = "✅ Mining Started!";
    paymentStatus.classList.remove("pending");
    paymentStatus.classList.add("confirmed");
  } else {
    paymentStatus.innerHTML = "❌ No Plan Bought";
    paymentStatus.classList.remove("confirmed");
    paymentStatus.classList.add("pending");
  }

  miningBalance.innerText = parseFloat(userData.balance).toFixed(6) + " BTC";
  totalMinedEl.innerText = parseFloat(userData.totalMined).toFixed(6) + " BTC";
  estimatedEarningsEl.innerText = "$" + (parseFloat(userData.totalMined)*btcPriceUSD).toFixed(2);
  referralsEl.innerText = userData.referrals + " Referrals";
  updateProgressBar();
}

function logout(){ localStorage.removeItem("currentUser"); window.location.href="index.html"; }
function goToPlans(){ window.location.href="plans.html"; }

function offlineBoost() {
  if(userData.plan && userData.paymentConfirmed){
    const boost = planRates[userData.plan] * 0.1;
    userData.balance += boost;
    userData.totalMined += boost;
    users[currentUser] = userData;
    localStorage.setItem("users", JSON.stringify(users));
    updateDashboard();
    showNotification("success", "Boost applied! +" + boost.toFixed(6) + " BTC");
  }
}

updateDashboard();

setInterval(()=>{
  if(userData.plan && userData.paymentConfirmed){
    const now = Date.now();
    const secondsPassed = (now - lastMiningTime)/1000;
    const increment = planRates[userData.plan]/24/60/60 * secondsPassed;
    userData.balance += increment;
    userData.totalMined += increment;
    users[currentUser] = userData;
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem(currentUser + "_lastMine", now);

    miningBalance.innerText = userData.balance.toFixed(6) + " BTC";
    totalMinedEl.innerText = userData.totalMined.toFixed(6) + " BTC";
    estimatedEarningsEl.innerText = "$" + (userData.totalMined*btcPriceUSD).toFixed(2);
    updateProgressBar();
    lastMiningTime = now;
  }
},1000);
</script>

</body>
</html>
