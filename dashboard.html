<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - BTC Mining Pro</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#0c0c1a; overflow-x:hidden; }
  header { background: rgba(0,0,0,0.7); padding:15px; color:white; text-align:center; z-index:2; position:relative;}
  nav { margin: 15px; text-align: center; z-index:2; position:relative;}
  nav a { margin: 0 15px; text-decoration: none; color: #00d1ff; font-weight: bold; transition: 0.3s; }
  nav a:hover { color: #28a745; text-decoration: underline; }

  /* Container */
  .container { max-width: 900px; margin: 20px auto; padding: 20px; position:relative; z-index:2; }

  /* Card */
  .card { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); padding:20px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.3); margin-bottom:20px; text-align:center; transition: transform 0.3s, box-shadow 0.3s;}
  .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.5); }

  .card h3 { margin:10px 0; color:#fff; }

  /* Dashboard Values */
  #planName { color: #00ff99; font-weight: bold; font-size: 1.5em; text-shadow: 1px 1px 5px rgba(0,255,150,0.7); margin-top: 10px; transition: transform 0.3s; }
  #miningRate { color: #00d1ff; font-weight: bold; font-size: 1.3em; text-shadow: 1px 1px 5px rgba(0,209,255,0.6); margin-top: 10px; transition: transform 0.3s; }
  .balance { font-size:22px; color:#00ff99; margin-top:10px; font-weight:bold; transition: transform 0.3s; }
  .animate-update { transform: scale(1.2); }

  .status { font-size:16px; margin:10px 0; }
  .pending { color:#ffc107; font-weight:bold; }
  .confirmed { color:#28a745; font-weight:bold; }

  .logout-btn, .buy-btn { display:inline-block; margin-top:15px; padding:10px 18px; color:white; border:none; border-radius:6px; cursor:pointer; text-decoration:none; transition:0.3s; }
  .logout-btn { background: #dc3545; }
  .logout-btn:hover { background: #b02a37; transform:scale(1.05);}
  .buy-btn { background: #28a745; }
  .buy-btn:hover { background: #218838; transform:scale(1.05); }

  /* Progress bar */
  .progress-container { background:#222; border-radius:20px; margin:10px 0; height:25px; width:100%; overflow:hidden; }
  .progress-bar { height:100%; width:0%; background: linear-gradient(90deg, #00ff99, #00d1ff); border-radius:20px; text-align:center; color:white; line-height:25px; font-weight:bold; transition: width 1s linear; }

  /* Stats Grid */
  .stats-grid { display: flex; justify-content: space-around; flex-wrap: wrap; margin-top:10px;}
  .stat-box { background: rgba(255,255,255,0.05); padding:20px; margin:10px; border-radius:12px; flex:1 1 250px; text-align:center; color:#fff; transition: transform 0.3s, box-shadow 0.3s;}
  .stat-box:hover { transform: translateY(-5px); box-shadow:0 10px 20px rgba(0,255,150,0.3);}
  .stat-box h4 { margin:5px 0; font-size:1em; }
  .stat-number.btc { color:#28a745; font-weight:bold; font-size:1.2em; transition: transform 0.3s; }
  .stat-number.usd { color:#00d1ff; font-weight:bold; font-size:1.2em; transition: transform 0.3s; }
  .stat-number.referrals { color:#ffc107; font-weight:bold; font-size:1.2em; transition: transform 0.3s; }

  @media (max-width:768px){
    .stats-grid { display:grid; grid-template-columns: repeat(2,1fr); gap:15px; justify-items:center; }
    .stat-box:nth-child(3) { grid-column:1/-1; }
  }

  /* Notification Modal */
  .modal { display:none; position:fixed; z-index:5; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5);}
  .modal-content { background:#222; color:white; margin:20% auto; padding:20px; width:90%; max-width:400px; text-align:center; border-radius:12px; }
  .modal-content button { margin-top:15px; padding:10px 15px; background:#28a745; color:#fff; border:none; border-radius:6px; cursor:pointer; }
  .modal-content button:hover { background:#00d1ff; }

  /* Canvas background */
  #particleCanvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; background:#0c0c1a; }
</style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<header>
  <h1>BTC Mining Pro Dashboard</h1>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="plans.html">Plans</a>
  <a href="withdraw.html">Withdraw</a>
  <a href="contact.html">Contact</a>
</nav>

<div class="container">

  <div class="card">
    <h3>Your Plan</h3>
    <div id="planName">No Plan Selected</div>
    <button id="buyPlanBtn" class="buy-btn" onclick="goToPlans()" style="display:none;">Buy a Plan</button>
  </div>

  <div class="card">
    <h3>Payment Status</h3>
    <div id="paymentStatus" class="status pending"></div>
  </div>

  <div class="card">
    <h3>Mining Rate</h3>
    <div id="miningRate">0 BTC/day</div>
  </div>

  <div class="card">
    <h3>Mining Balance</h3>
    <div class="balance" id="miningBalance">0.000000 BTC</div>
    <!-- <div class="progress-container">
      <div class="progress-bar" id="progressBar">0%</div>
    </div> -->
  </div>

  <div class="card stats-grid">
    <div class="stat-box">
      <h4>💰 Total BTC Mined</h4>
      <div id="totalMined" class="stat-number btc">0.000000 BTC</div>
    </div>
    <div class="stat-box">
      <h4>💵 Estimated Earnings</h4>
      <div id="estimatedEarnings" class="stat-number usd">$0.00</div>
    </div>
    <div class="stat-box">
      <h4>👥 Referral Stats</h4>
      <div id="referrals" class="stat-number referrals">0 Referrals</div>
    </div>
  </div>

  <div class="card">
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

</div>

<div id="notificationModal" class="modal">
  <div class="modal-content">
    <p id="notificationMessage"></p>
    <button id="closeNotificationBtn">Close</button>
  </div>
</div>

<script>
/* ==========================
   Particle Background
========================== */
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

const particles = [];
const particleCount = 120;
for(let i=0;i<particleCount;i++){
  particles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*3+1,
    dx: (Math.random()-0.5)*0.5,
    dy: (Math.random()-0.5)*0.5
  });
}

function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let p of particles){
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle = 'rgba(0,255,150,0.7)';
    ctx.fill();
    p.x += p.dx;
    p.y += p.dy;
    if(p.x<0||p.x>canvas.width)p.dx*=-1;
    if(p.y<0||p.y>canvas.height)p.dy*=-1;
  }
  requestAnimationFrame(animateParticles);
}
animateParticles();

/* ==========================
   Dashboard Logic
========================== */
const btcPriceUSD = 30000;
const planRates = { "Starter":0.006, "Silver":0.018, "Gold":0.04 };
const currentUser = localStorage.getItem("currentUser");
let users = JSON.parse(localStorage.getItem("users"))||{};
let userData = users[currentUser] || { plan:"", paymentConfirmed:false, balance:0, totalMined:0, referrals:0 };

const planName = document.getElementById("planName");
const paymentStatus = document.getElementById("paymentStatus");
const miningRate = document.getElementById("miningRate");
const miningBalance = document.getElementById("miningBalance");
const progressBar = document.getElementById("progressBar");
const totalMinedEl = document.getElementById("totalMined");
const estimatedEarningsEl = document.getElementById("estimatedEarnings");
const referralsEl = document.getElementById("referrals");
const buyPlanBtn = document.getElementById("buyPlanBtn");

let lastMiningTime = parseInt(localStorage.getItem(currentUser+"_lastMine"))||Date.now();
let lastReset = parseInt(localStorage.getItem(currentUser+"_lastReset"))||Date.now();

const notificationModal = document.getElementById("notificationModal");
const notificationMessage = document.getElementById("notificationMessage");
const closeNotificationBtn = document.getElementById("closeNotificationBtn");
closeNotificationBtn.onclick = ()=>{ notificationModal.style.display="none"; }
window.onclick = e=>{ if(e.target==notificationModal) notificationModal.style.display="none"; }

function animateValue(element,newValue){
  element.classList.add('animate-update');
  element.innerText = newValue;
  setTimeout(()=>{ element.classList.remove('animate-update'); },300);
}

function updateProgressBar(){
  const plan = userData.plan;
  if(!plan){
    progressBar.style.width = "0%";
    progressBar.innerText = "0%";
    return;
  }
  const now = Date.now();
  const secondsSinceReset = (now-lastReset)/1000;
  const dailyLimit = planRates[plan];
  let balanceProgress = Math.min(userData.balance,dailyLimit);
  const progressPercent = Math.min((balanceProgress/dailyLimit)*100,100);
  progressBar.style.width = progressPercent + "%";
  progressBar.innerText = progressPercent.toFixed(1) + "%";
}

function startMining(){
  if(userData.plan && !userData.paymentConfirmed){
    paymentStatus.innerHTML = "⏳ Starting Mining...";
    paymentStatus.classList.remove("confirmed");
    paymentStatus.classList.add("pending");
    setTimeout(()=>{
      userData.paymentConfirmed = true;
      users[currentUser] = userData;
      localStorage.setItem("users",JSON.stringify(users));
      paymentStatus.innerHTML = "✅ Mining Started!";
      paymentStatus.classList.remove("pending");
      paymentStatus.classList.add("confirmed");
      lastReset = Date.now();
      localStorage.setItem(currentUser+"_lastReset",lastReset);
      notificationMessage.innerText="Mining has started!";
      notificationModal.style.display="block";
    },5000);
  }
}

function updateDashboard(){
  const plan = userData.plan;
  animateValue(planName, plan||"No Plan Bought");
  buyPlanBtn.style.display = plan ? "none" : "inline-block";
  animateValue(miningRate, plan ? planRates[plan]+" BTC/day" : "0 BTC/day");

  if(plan && !userData.paymentConfirmed) startMining();
  else if(plan && userData.paymentConfirmed){
    paymentStatus.innerHTML="✅ Mining Started!";
    paymentStatus.classList.remove("pending");
    paymentStatus.classList.add("confirmed");
  } else {
    paymentStatus.innerHTML="❌ No Plan Bought";
    paymentStatus.classList.remove("confirmed");
    paymentStatus.classList.add("pending");
  }

  animateValue(miningBalance, parseFloat(userData.balance).toFixed(6)+" BTC");
  animateValue(totalMinedEl, parseFloat(userData.totalMined).toFixed(6)+" BTC");
  animateValue(estimatedEarningsEl, "$"+(parseFloat(userData.totalMined)*btcPriceUSD).toFixed(2));
  animateValue(referralsEl, userData.referrals+" Referrals");

  updateProgressBar();
}

function logout(){ localStorage.removeItem("currentUser"); window.location.href="index.html"; }
function goToPlans(){ window.location.href="plans.html"; }

updateDashboard();

setInterval(()=>{
  if(userData.plan && userData.paymentConfirmed){
    const now = Date.now();
    const secondsPassed = (now - lastMiningTime)/1000;
    const increment = planRates[userData.plan]/86400*secondsPassed;
    userData.balance += increment;
    userData.totalMined += increment;

    if(now - lastReset >= 86400*1000){
      userData.balance = 0;
      lastReset = now;
      localStorage.setItem(currentUser+"_lastReset", lastReset);
    }

    users[currentUser] = userData;
    localStorage.setItem("users",JSON.stringify(users));
    localStorage.setItem(currentUser+"_lastMine",now);

    animateValue(miningBalance, userData.balance.toFixed(6)+" BTC");
    animateValue(totalMinedEl, userData.totalMined.toFixed(6)+" BTC");
    animateValue(estimatedEarningsEl, "$"+(userData.totalMined*btcPriceUSD).toFixed(2));
    updateProgressBar();

    lastMiningTime = now;
  }
},1000);

</script>

</body>
</html>
